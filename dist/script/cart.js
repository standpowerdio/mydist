"use strict";!function(k){k.ajax({url:"http://localhost/xiangmu/php/cart.php",dataType:"json"}).done(function(i){var s=jscookie.get("sid").split(","),c=jscookie.get("num").split(","),t=k(".list_center"),n="",a=0;k.each(s,function(s,e){k.each(i,function(i,t){e===t.sid&&(n+='\n                    <div class="list_card" sid='+e+'>\n                    <div class="chkbox">\n                        <input class="chk selects" type="checkbox">\n                    </div>\n                    <div class="info">\n                        <a href="details.html?sid='+e+'"><img src="'+t.piclist.split(",")[0]+'_90x90.jpg" alt=""></a>\n                        <p>'+t.title+'</p>\n                    </div>\n                    <div class="unit-price">\n                    '+t.price+'\n                    </div>\n                    <div class="num-box">\n                        <div class="addbox">\n                            <div class="sub">–</div>\n                            <input type="text" price="'+t.price+'" value="'+c[s]+'">\n                            <div class="add">+</div>\n                        </div>\n                    </div>\n                    <div class="weight">0.5kg</div>\n                    <div class="total"><i>¥</i><span>'+(c[s]*t.price).toFixed(1)+'</span></div>\n                    <div class="delete"><a href="javascript:"></a></div>\n                </div>\n                    ',a+=c[s]*t.price)})}),t.html(n),k(".chk").prop("checked",!0),k(".num span").html(a.toFixed(1));var e="",d="";function l(i,t){d=i,e=t.parents(".list_card").attr("sid"),c.splice(s.indexOf(e),1,d),jscookie.add("sid",s,99999),jscookie.add("num",c,99999),d=e=""}var p=k(".add"),r=k(".sub"),h=k(".addbox input"),o=/^[1-9]+$/,u={};function v(){a=0,k.each(k(".selects:checked"),function(i,t){a+=k(this).parents(".list_card").children(".num-box").find("input").val()*k(this).parents(".list_card").children(".num-box").find("input").attr("price")}),k(".num span").html(a.toFixed(1))}k.each(h,function(i,t){u[k(this).index("input")]=parseInt(k(this).val())}),h.on("blur",function(){var i=k(this).index("input");u[i]=1,o.test(k(this).val())?(parseInt(k(this).val())<1&&(u[i]=1,k(this).val("1")),999<parseInt(k(this).val())?(u[i]=999,k(this).val("999")):(u[i]=parseInt(k(this).val()),k(this).val(u[i]))):(u[i]=1,k(this).val("1")),v(),k(this).parents(".list_card").find("span").html((u[i]*k(this).attr("price")).toFixed(1)),l(u[i],k(this))}),p.on("click",function(){var i=k(this).parent().children("input").index("input");u[i]<999&&(u[i]++,k(this).parent().children("input").val(u[i]),l(u[i],k(this))),v(),k(this).parents(".list_card").find("span").html((u[i]*k(this).siblings("input").attr("price")).toFixed(1))}),r.on("click",function(){var i=k(this).parent().children("input").index("input");1<u[i]&&(u[i]--,k(this).parent().children("input").val(u[i]),l(u[i],k(this))),v(),k(this).parents(".list_card").find("span").html((u[i]*k(this).siblings("input").attr("price")).toFixed(1))}),k(".chk:first").on("click",function(){k(".chk:first").prop("checked")?k(".chk").prop("checked",!0):k(".chk").prop("checked",!1),v()}),k(".selects").on("click",function(){k(".selects:checked").size()===k(".selects").size()?k(".chk:first").prop("checked",!0):k(".chk:first").prop("checked",!1),v()}),k(".delete a").on("click",function(){confirm("确定删除这个商品吗")&&(k(this).parents(".list_card").remove(),k(".selects:checked").size()===k(".selects").size()?k(".chk:first").prop("checked",!0):k(".chk:first").prop("checked",!1),e=k(this).parents(".list_card").attr("sid"),d=s.indexOf(e),s.splice(d,1),c.splice(d,1),jscookie.add("sid",s,99999),jscookie.add("num",c,99999),d=e="",v())}),k(".deleteall a").on("click",function(){confirm("确定批量删除商品吗")&&(k.each(k(".selects:checked").parents(".list_card"),function(i,t){e=k(this).attr("sid"),d=s.indexOf(e),s.splice(d,1),c.splice(d,1)}),jscookie.add("sid",s,99999),jscookie.add("num",c,99999),d=e="",k(".selects:checked").parents(".list_card").remove(),k(".chk:first").prop("checked",!1),v())})})}(jQuery);