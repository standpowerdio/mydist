"use strict";!function(p){function u(a){for(var t=p(".goodslist"),n="",i=0;i<a.length;i++)n+='\n            <div class="goodscard">                        \n                        <div class="goodscard_center">\n                            <a href="details.html?sid='+a[i].sid+'"><img class="lazy" data-original="'+a[i].piclist.split(",")[0]+'_240x240.jpg" width="240" height="240"></a>\n                            <a href="details.html?sid='+a[i].sid+'" class="goodscard_name">'+a[i].title+'</a>\n                            <p class="goodscard_info">'+a[i].info+'</p>\n                            <p class="goodscard_price">\n                                <i>¥</i>\n                                <span>'+a[i].price+'<span>\n                            </p>\n                            <div class="push_shoopingcart">\n                                <div class="num">\n                                    <div class="sub">–</div>\n                                    <input type="text" value="1">\n                                    <div class="add">+</div>\n                                </div>\n                                <div class="addincart" sid="'+a[i].sid+'">\n                                    <i></i>加入购物车\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n            ';t.html(n),p(function(){p("img.lazy").lazyload({effect:"show"})})}p.ajax({url:"http://localhost/xiangmu/php/goodslist.php",dataType:"json"}).done(function(a){u(a);var t=p(".add"),n=p(".sub"),i=p(".num input"),s=/^[1-9]+$/,e={};p.each(i,function(a,t){e[p(this).index("input")]=parseInt(p(this).val())}),i.on("blur",function(){var a=p(this).index("input");e[a]=1,s.test(p(this).val())?(parseInt(p(this).val())<1&&(e[a]=1,p(this).val("1")),999<parseInt(p(this).val())?(e[a]=999,p(this).val("999")):(e[a]=parseInt(p(this).val()),p(this).val(e[a]))):(e[a]=1,p(this).val("1"))}),t.on("click",function(){var a=p(this).parent().children("input").index("input");e[a]<999&&(e[a]++,p(this).parent().children("input").val(e[a]))}),n.on("click",function(){var a=p(this).parent().children("input").index("input");1<e[a]&&(e[a]--,p(this).parent().children("input").val(e[a]))});var r=[],o=[],d="",l="",c=p(".addincart");jscookie.get("sid")&&jscookie.get("num")&&(r=jscookie.get("sid").split(","),o=jscookie.get("num").split(",")),c.on("click",function(){d=p(this).attr("sid"),l=parseInt(p(this).parents(".goodscard").find(".num").children("input").val()),-1!==r.indexOf(d)?o.splice(r.indexOf(d),1,parseInt(o[r.indexOf(d)])+l):(r.push(d),o.push(l)),jscookie.add("sid",r,99999),jscookie.add("num",o,99999),alert("成功加入"+l+"个商品到购物车")}),array_default=[],array=[],prev=null,next=null,p(".goodscard").each(function(a,t){array[a]=p(this),array_default[a]=p(this)}),p(".sorttype").eq(2).on("click",function(){for(var a=0;a<array.length-1;a++)for(var t=0;t<array.length-a-1;t++)if(prev=parseFloat(array[t].find(".goodscard_price span").text()),next=parseFloat(array[t+1].find(".goodscard_price span").text()),prev>next){var n=array[t];array[t]=array[t+1],array[t+1]=n}p(".goodslist").empty(),p.each(array,function(a,t){p(".goodslist").append(t)}),p(function(){p("img.lazy").lazyload({effect:"show"})})}),p(".sorttype").eq(0).on("click",function(){p(".goodslist").empty(),p.each(array_default,function(a,t){p(".goodslist").append(t)}),p(function(){p("img.lazy").lazyload({effect:"show"})})}),p(".sorttype").eq(1).on("click",function(){for(var a=0;a<array.length-1;a++)for(var t=0;t<array.length-a-1;t++)if(prev=parseFloat(array[t].find(".goodscard_price span").text()),next=parseFloat(array[t+1].find(".goodscard_price span").text()),prev<next){var n=array[t];array[t]=array[t+1],array[t+1]=n}p(".goodslist").empty(),p.each(array,function(a,t){p(".goodslist").append(t)}),p(function(){p("img.lazy").lazyload({effect:"show"})})})}),p(".page").pagination({pageCount:3,jump:!0,coping:!0,prevContent:"上一页",nextContent:"下一页",homePage:"首页",endPage:"尾页",callback:function(a){p.ajax({url:"http://localhost/xiangmu/php/goodslist.php",data:{page:a.getCurrent()},dataType:"json"}).done(function(a){u(a),array_default=[],array=[],prev=null,next=null,p(".goodscard").each(function(a,t){array[a]=p(this),array_default[a]=p(this)}),p(".sorttype").removeClass("active"),p(".sorttype").eq(0).addClass("active")})}}),p(".sorttype").on("click",function(){p(".sorttype").removeClass("active"),p(this).addClass("active")})}(jQuery);